# Nagent
网络穿透代理，名称来源于Nat与Agent的组合。类似frp项目，可以穿透局域网为互联网提供服务。  
前提是你要有一台流量服务器并且有一个公网IP。如果没有，也可以找服务商。  
暂不能向frp那样为HTTP服务，但可以实现简单的分发————你只需要在两台内网HTTP服务器上运行Nagent客户端即可。  

## 进度
正常使用,比较稳定  
这些情况进行了测试：http(IIS/nginx/nextcloud),ssh,webdav  
未向特殊协议优化，例如http/s的转发  
虽然协议有涉及账号名与密码，但未实现  
未来希望你或我，向项目添加账号管理支持，以webservice的形式支持  
  
## 名词解释
客户端：运行在内网的Nagent客户端。  
服务端：运行在公网服务器上的Nagent服务端。  
用户：互联网上的实际用户。  
  
## 过程
服务器监听在5670端口（默认）。  
客户端配置好自己的服务端口，也可以指定内网其他计算机。假设本机80端口。  
客户端登录到服务器，通知服务器我需要监听的外网端口，比如90。  
一切正常的话（防火墙没问题，端口没被占用等），服务器上90端口的连接即会被导向到内网的80端口服务上。  
  
## 原理
客户端与服务器保持着一定数量的连接，每个连接都需要登录成功。  
用户连接公网服务器的端口后会从客户端的列表中弹出一个用于数据转发。  
当客户端第一次收到数据时，建立与本地服务的连接，并发送/转发数据。  

## 部署
需要NodeJS 
  
## 运行为服务端
windows/linux:  
node nagent.js -s  
linux:  
./nagent.js -s  
   
### 运行为服务
linux下用   
nohup ./nagent.js -s > out 2>&1 &   
windows下用计划任务   
win键，输入jihua，选计划任务，创建任务，起个名nagent，选不管用户是否登录，切换到触发器标签，新建，开始任务选“启动时”，切换到操作标签，新建，程序选node，参数选nagent.js（可以附带nagent参数），起始于选择nagent目录。再回到任务列表手动启动nagent任务。
  
## 运行为客户端
windows/linux:  
node nagent.js -p 90 -P 80  
linux:  
./nagent.js -p 90 -P 80  
  
## 配置
保存下面内容到nagent.js所在的目录，文件名为nagent.config，方括号内替换为你的参数。  
local_port=\[你的本地服务端口\]  
server_port=5670// 服务端端口号  
server_host='\[服务端的主机地址，IP或域名均可\]'  
remote_port=\[你需要服务端为你开放的公网端口\]  
keep_conn_count=10// 同时保持的最大连接数量  
  
